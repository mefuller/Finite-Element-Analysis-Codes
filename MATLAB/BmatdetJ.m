%% x = [x1 y1 x2 y2 x3 y3 x4 y4], loc = [xi eta]
function [Bmat detJ] = BmatdetJ(x,loc)
    xi = loc(1); eta = loc(2);
    x1 = x(1); y1 = x(2); x2 = x(3); y2 = x(4);
    x3 = x(5); y3 = x(6); x4 = x(7); y4 = x(8);
    Jac = (1/4)*[-(1-eta)*x1 + (1-eta)*x2 + (1+eta)*x3 - (1+eta)*x4 ...
        -(1-eta)*y1 + (1-eta)*y2 + (1+eta)*y3 - (1+eta)*y4;...
        -(1-xi)*x1 - (1+xi)*x2 + (1+xi)*x3 + (1-xi)*x4 ...
        -(1-xi)*y1 - (1+xi)*y2 + (1+xi)*y3 + (1-xi)*y4];
    J11 = Jac(1,1); J12 = Jac(1,2); J21 = Jac(2,1); J22 = Jac(2,2);
    detJ = J11*J22-J12*J21;
    A = (1/detJ)*[J22 -J12 0 0; 0 0 -J21 J11; -J21 J11 J22 -J12];
    G = (1/4)*[-(1-eta) 0 (1-eta) 0 (1+eta) 0 -(1+eta) 0;...
               -(1-xi) 0 -(1+xi) 0 (1+xi) 0 (1-xi) 0;...
               0 -(1-eta) 0 (1-eta) 0 (1+eta) 0 -(1+eta);...
               0 -(1-xi) 0 -(1+xi) 0 (1+xi) 0 (1-xi)];
    Bmat = A*G;